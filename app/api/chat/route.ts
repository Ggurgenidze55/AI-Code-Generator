import { type NextRequest, NextResponse } from "next/server"

export async function POST(request: NextRequest) {
  try {
    const { message, messages } = await request.json()

    if (!message?.trim()) {
      return NextResponse.json({ error: "Message is required", success: false }, { status: 400 })
    }

    // Simple responses without OpenAI for now
    const responses = {
      "рЃарЃљ рЃљрЃарЃўрЃА react":
        "React рЃљрЃарЃўрЃА JavaScript рЃЉрЃўрЃЉрЃџрЃўрЃЮрЃЌрЃћрЃЎрЃљ рЃЏрЃЮрЃЏрЃ«рЃЏрЃљрЃарЃћрЃЉрЃџрЃўрЃА рЃўрЃюрЃбрЃћрЃарЃцрЃћрЃўрЃАрЃўрЃА рЃерЃћрЃАрЃљрЃЦрЃЏрЃюрЃћрЃџрЃљрЃЊ. рЃўрЃА рЃАрЃљрЃерЃБрЃљрЃџрЃћрЃЉрЃљрЃА рЃњрЃљрЃФрЃџрЃћрЃЋрЃА рЃерЃћрЃЦрЃЏрЃюрЃљ рЃўрЃюрЃбрЃћрЃарЃљрЃЦрЃбрЃўрЃБрЃџрЃў рЃЋрЃћрЃЉ рЃљрЃърЃџрЃўрЃЎрЃљрЃфрЃўрЃћрЃЉрЃў рЃЎрЃЮрЃЏрЃърЃЮрЃюрЃћрЃюрЃбрЃћрЃЉрЃўрЃА рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃЌ.",
      "рЃарЃЮрЃњрЃЮрЃа рЃЋрЃўрЃАрЃгрЃљрЃЋрЃџрЃЮ javascript":
        "JavaScript-рЃўрЃА рЃАрЃгрЃљрЃЋрЃџрЃўрЃАрЃЌрЃЋрЃўрЃА: 1) рЃЊрЃљрЃўрЃгрЃДрЃћ рЃФрЃўрЃарЃўрЃЌрЃљрЃЊрЃў рЃАрЃўрЃюрЃбрЃљрЃЦрЃАрЃўрЃЌ, 2) рЃўрЃЋрЃљрЃарЃ»рЃўрЃерЃћ DOM рЃЏрЃљрЃюрЃўрЃърЃБрЃџрЃљрЃфрЃўрЃљрЃерЃў, 3) рЃўрЃАрЃгрЃљрЃЋрЃџрЃћ ES6+ рЃцрЃБрЃюрЃЦрЃфрЃўрЃћрЃЉрЃў, 4) рЃерЃћрЃЦрЃЏрЃћрЃюрЃў рЃърЃљрЃбрЃљрЃарЃљ рЃърЃарЃЮрЃћрЃЦрЃбрЃћрЃЉрЃў.",
      "рЃарЃљ рЃљрЃарЃўрЃА html":
        "HTML (HyperText Markup Language) рЃљрЃарЃўрЃА рЃЋрЃћрЃЉ рЃњрЃЋрЃћрЃарЃЊрЃћрЃЉрЃўрЃА рЃерЃћрЃЦрЃЏрЃюрЃўрЃА рЃФрЃўрЃарЃўрЃЌрЃљрЃЊрЃў рЃћрЃюрЃљ. рЃўрЃА рЃњрЃљрЃюрЃАрЃљрЃќрЃдрЃЋрЃарЃљрЃЋрЃА рЃЋрЃћрЃЉ рЃњрЃЋрЃћрЃарЃЊрЃўрЃА рЃАрЃбрЃарЃБрЃЦрЃбрЃБрЃарЃљрЃА рЃЊрЃљ рЃерЃўрЃюрЃљрЃљрЃарЃАрЃА.",
      "рЃарЃљ рЃљрЃарЃўрЃА css":
        "CSS (Cascading Style Sheets) рЃљрЃарЃўрЃА рЃАрЃбрЃўрЃџрЃћрЃЉрЃўрЃА рЃћрЃюрЃљ, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃљрЃдрЃгрЃћрЃарЃА HTML рЃћрЃџрЃћрЃЏрЃћрЃюрЃбрЃћрЃЉрЃўрЃА рЃњрЃљрЃарЃћрЃњрЃюрЃЮрЃЉрЃљрЃА рЃЊрЃљ рЃњрЃљрЃюрЃџрЃљрЃњрЃћрЃЉрЃљрЃА.",
      "рЃарЃЮрЃњрЃЮрЃа рЃЋрЃўрЃАрЃгрЃљрЃЋрЃџрЃЮ рЃърЃарЃЮрЃњрЃарЃљрЃЏрЃўрЃарЃћрЃЉрЃљ":
        "рЃърЃарЃЮрЃњрЃарЃљрЃЏрЃўрЃарЃћрЃЉрЃўрЃА рЃАрЃгрЃљрЃЋрЃџрЃўрЃАрЃЌрЃЋрЃўрЃА: 1) рЃљрЃўрЃарЃЕрЃўрЃћ рЃћрЃюрЃљ (JavaScript, Python), 2) рЃўрЃАрЃгрЃљрЃЋрЃџрЃћ рЃФрЃўрЃарЃўрЃЌрЃљрЃЊрЃў рЃЎрЃЮрЃюрЃфрЃћрЃцрЃфрЃўрЃћрЃЉрЃў, 3) рЃўрЃЋрЃљрЃарЃ»рЃўрЃерЃћ рЃДрЃЮрЃЋрЃћрЃџрЃЊрЃдрЃћ, 4) рЃерЃћрЃЦрЃЏрЃћрЃюрЃў рЃърЃарЃЮрЃћрЃЦрЃбрЃћрЃЉрЃў.",
    }

    const lowerMessage = message.toLowerCase()

    // Check for exact matches
    for (const [key, response] of Object.entries(responses)) {
      if (lowerMessage.includes(key.toLowerCase())) {
        return NextResponse.json({
          response: response,
          success: true,
        })
      }
    }

    // Default helpful response
    let defaultResponse =
      "рЃЏрЃўрЃ«рЃЋрЃЊрЃў! рЃерЃћрЃЏрЃўрЃФрЃџрЃўрЃљ рЃЊрЃљрЃњрЃћрЃ«рЃЏрЃљрЃарЃЮ:\n\n­Ъћ╣ рЃЎрЃЮрЃЊрЃўрЃА рЃерЃћрЃЦрЃЏрЃюрЃљрЃерЃў (рЃЏрЃљрЃњ: 'рЃерЃћрЃЦрЃЏрЃћрЃюрЃў todo рЃљрЃърЃў')\n­Ъћ╣ рЃърЃарЃЮрЃњрЃарЃљрЃЏрЃўрЃарЃћрЃЉрЃўрЃА рЃЎрЃўрЃЌрЃ«рЃЋрЃћрЃЉрЃерЃў\n­Ъћ╣ рЃбрЃћрЃЦрЃюрЃўрЃЎрЃБрЃа рЃАрЃљрЃЎрЃўрЃЌрЃ«рЃћрЃЉрЃерЃў\n\nрЃарЃљ рЃњрЃљрЃўрЃюрЃбрЃћрЃарЃћрЃАрЃћрЃЉрЃА?"

    // Check if it's a code generation request
    if (lowerMessage.includes("рЃерЃћрЃЦрЃЏрЃћрЃюрЃў") || lowerMessage.includes("рЃњрЃљрЃљрЃЎрЃћрЃЌрЃћ") || lowerMessage.includes("рЃЊрЃљрЃгрЃћрЃарЃћ")) {
      defaultResponse =
        "рЃЎрЃЮрЃЊрЃўрЃА рЃерЃћрЃЦрЃЏрЃюрЃўрЃАрЃЌрЃЋрЃўрЃА рЃЕрЃљрЃгрЃћрЃарЃћ рЃЎрЃЮрЃюрЃЎрЃарЃћрЃбрЃБрЃџрЃў рЃЏрЃЮрЃЌрЃ«рЃЮрЃЋрЃюрЃљ, рЃЏрЃљрЃњрЃљрЃџрЃўрЃЌрЃљрЃЊ:\nРђб 'рЃерЃћрЃЦрЃЏрЃћрЃюрЃў todo рЃљрЃърЃў'\nРђб 'рЃњрЃљрЃљрЃЎрЃћрЃЌрЃћ calculator'\nРђб 'рЃЊрЃљрЃгрЃћрЃарЃћ landing page'\n\nрЃЎрЃЮрЃЊрЃў рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃљрЃЊ рЃерЃћрЃўрЃЦрЃЏрЃюрЃћрЃЉрЃљ рЃЊрЃљ рЃърЃарЃўрЃЋрЃўрЃБрЃерЃў рЃњрЃљрЃЏрЃЮрЃЕрЃюрЃЊрЃћрЃЉрЃљ!"
    }

    return NextResponse.json({
      response: defaultResponse,
      success: true,
    })
  } catch (error: any) {
    console.error("Chat error:", error)
    return NextResponse.json({
      response: "рЃерЃћрЃфрЃЊрЃЮрЃЏрЃљ рЃЏрЃЮрЃ«рЃЊрЃљ. рЃАрЃфрЃљрЃЊрЃћ рЃ«рЃћрЃџрЃљрЃ«рЃџрЃљ.",
      success: true,
    })
  }
}
